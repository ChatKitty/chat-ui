var I=Object.defineProperty;var L=(e,t,n)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var m=(e,t,n)=>(L(e,typeof t!="symbol"?t+"":t,n),n);import{html as K,render as B}from"lit-html";import{html as $}from"lit-html";var M=({message:e})=>$`<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Error: ${e}</title><style>body{font-family:Arial,sans-serif;background-color:#f7f9fc;color:#333;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:0}.error-container{max-width:600px;padding:20px;background-color:#fff;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,.1);text-align:center}.error-header{font-size:24px;font-weight:700;margin-bottom:10px}.error-description{margin-bottom:20px}.error-hint{font-size:14px;color:#666}a{color:#007bff;text-decoration:none}a:hover{text-decoration:underline}</style></head><body><div class="error-container"><div class="error-header">Oops! ${e}</div><div class="error-description">We're sorry, but the Chat UI service is currently unavailable. Please try again later.</div><div class="error-hint">If the problem persists, please <a href="mailto:support@chatkitty.com">contact support</a>.</div></div></body></html>`;var h=class{constructor(t){m(this,"listeners");m(this,"port");this.listeners=new Map,t.addEventListener("message",n=>{let{type:o,payload:r}=n.data;if(!this.listeners.has(o))return;this.listeners.get(o).forEach(i=>{i(r)})}),this.port=t}subscribe(t,n){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n)}unsubscribe(t,n){if(!this.listeners.has(t))return;let o=this.listeners.get(t),r=o.indexOf(n);r>-1&&o.splice(r,1)}dispatch(t){this.port.postMessage(t)}};var f="https://ui.chatkitty.com",T=(e,t)=>{let n=document.createElement("div");B(t,n),e.srcdoc=n.innerHTML},H=K,O=e=>{var g,w,v;let t=((g=e.container)==null?void 0:g.id)||"chat-ui",n=document.getElementById(t);if(!n)throw new Error(`Chat UI container not found. Please define a div with id "${t}" in your HTML page.`);if(n.hasChildNodes())throw new Error(`Chat UI container must be empty. Please remove all child elements from the div with id "${t}".`);n.style.display="relative",n.style.height=((w=e.container)==null?void 0:w.height)||"100vh",n.style.width=((v=e.container)==null?void 0:v.width)||"100%";let o=document.createElement("iframe");o.title="Chat UI",o.src=`${f}/chat?widget_id=${e.widgetId}${e.locale?`&locale=${e.locale}`:""}`,o.allow="autoplay; clipboard-write; fullscreen; geolocation; microphone",o.style.height="100%",o.style.width="100%",o.style.border="none";let r=new MessageChannel,p=r.port1,i=new h(p),y=!1;i.subscribe("chat-ui:connected",()=>{let a=e.onNotificationReceived;a&&i.subscribe("chat:notification-received",s=>{a(s)}),i.dispatch({type:"chat:initialize",payload:{options:{username:e.username,theme:e.theme,authentication:e.authentication,profile:e.profile,route:e.route,environment:e.$environment}}}),y=!0}),i.subscribe("chat:mounted",a=>{let s=e.chatComponent;if(!s)return;let d=s({locale:a.locale}),b=e.localization;b&&i.dispatch({type:"chat:strings-set",payload:{strings:b({locale:a.locale})}});let C=e.audio;C&&i.dispatch({type:"chat:audio-set",payload:{audio:C}});let l=d.menuActions;l==null||l.forEach(c=>{if(c.name.includes("$"))throw new Error(`Menu action name "${c.name}" cannot contain "$" character.`)}),l&&i.dispatch({type:"chat:menu-actions-set",payload:{actions:l}});let E=d.onMounted;E&&E();let x=d.onHeaderSelected;x&&i.subscribe("chat:header-selected",c=>{x(c)});let U=d.onMenuActionSelected;U&&i.subscribe("chat:menu-action-selected",c=>{U(c)})}),window.addEventListener("message",a=>{var s;a.origin===f&&a.data==="chatkitty:chat-ui-mounted"&&((s=o.contentWindow)==null||s.postMessage({type:"chat-ui:connect",payload:{version:"2.29.1",environment:"production"}},f,[r.port2]))});let u=e.errorTemplate||M;o.addEventListener("error",a=>{T(o,u({message:a.message}))}),p.start(),n.appendChild(o),setTimeout(()=>{y||T(o,u({message:"Connection timed out."}))},1e4)};export{O as loadChatUi,H as template};
