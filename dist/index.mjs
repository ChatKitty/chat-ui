var I=Object.defineProperty;var $=(e,t,i)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var f=(e,t,i)=>($(e,typeof t!="symbol"?t+"":t,i),i);import{html as B,render as N}from"lit-html";import{html as K}from"lit-html";var L=({message:e})=>K`<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Error: ${e}</title><style>body{font-family:Arial,sans-serif;background-color:#f7f9fc;color:#333;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:0}.error-container{max-width:600px;padding:20px;background-color:#fff;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,.1);text-align:center}.error-header{font-size:24px;font-weight:700;margin-bottom:10px}.error-description{margin-bottom:20px}.error-hint{font-size:14px;color:#666}a{color:#007bff;text-decoration:none}a:hover{text-decoration:underline}</style></head><body><div class="error-container"><div class="error-header">Oops! ${e}</div><div class="error-description">We're sorry, but the Chat UI service is currently unavailable. Please try again later.</div><div class="error-hint">If the problem persists, please <a href="mailto:support@chatkitty.com">contact support</a>.</div></div></body></html>`;var p=class{constructor(t){f(this,"listeners");f(this,"port");this.listeners=new Map,t.addEventListener("message",i=>{let{type:o,payload:n}=i.data;if(!this.listeners.has(o))return;this.listeners.get(o).forEach(d=>{d(n)})}),this.port=t}subscribe(t,i){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(i)}unsubscribe(t,i){if(!this.listeners.has(t))return;let o=this.listeners.get(t),n=o.indexOf(i);n>-1&&o.splice(n,1)}dispatch(t){this.port.postMessage(t)}};var y="https://ui.chatkitty.com",T=(e,t)=>{let i=document.createElement("div");N(t,i),e.srcdoc=i.innerHTML},H=B,V=(e,t)=>{var w,v,b;let i=((w=e.container)==null?void 0:w.id)||"chat-ui",o=document.getElementById(i);if(!o)throw new Error(`Chat UI container not found. Please define a div with id "${i}" in your HTML page.`);if(o.hasChildNodes())throw new Error(`Chat UI container must be empty. Please remove all child elements from the div with id "${i}".`);o.style.display="relative",o.style.height=((v=e.container)==null?void 0:v.height)||"100vh",o.style.width=((b=e.container)==null?void 0:b.width)||"100%";let n=document.createElement("iframe");n.title="Chat UI",n.src=`${y}/chat?widget_id=${e.widgetId}${e.locale?`&locale=${e.locale}`:""}`,n.allow="autoplay; clipboard-write; fullscreen; geolocation; microphone",n.style.height="100%",n.style.width="100%",n.style.border="none";let m=new MessageChannel,d=m.port1,r=new p(d),u=!1;r.subscribe("chat-ui:connected",()=>{let a=e.onNotificationReceived;a&&r.subscribe("chat:notification-received",s=>{a(s)}),r.dispatch({type:"chat:initialize",payload:{options:{username:e.username,theme:e.theme,authentication:e.authentication,profile:e.profile,route:e.route,environment:e.$environment}}}),u=!0}),r.subscribe("chat:mounted",a=>{let s=e.chatComponent;if(!s)return;let h=s({locale:a.locale}),C=e.localization;C&&r.dispatch({type:"chat:strings-set",payload:{strings:C({locale:a.locale})}});let E=e.audio;E&&r.dispatch({type:"chat:audio-set",payload:{audio:E}});let l=h.menuActions;l==null||l.forEach(c=>{if(c.name.includes("$"))throw new Error(`Menu action name "${c.name}" cannot contain "$" character.`)}),l&&r.dispatch({type:"chat:menu-actions-set",payload:{actions:l}});let x=h.onMounted;x&&x();let U=h.onHeaderSelected;U&&r.subscribe("chat:header-selected",c=>{U(c)});let M=h.onMenuActionSelected;M&&r.subscribe("chat:menu-action-selected",c=>{M(c)})}),window.addEventListener("message",a=>{var s;a.origin===y&&a.data==="chatkitty:chat-ui-mounted"&&((s=n.contentWindow)==null||s.postMessage({type:"chat-ui:connect",payload:{version:"2.30.0",environment:"production"}},y,[m.port2]))});let g=e.errorTemplate||L;n.addEventListener("error",a=>{T(n,g({message:a.message}))}),d.start(),o.appendChild(n),setTimeout(()=>{u||T(n,g({message:"Connection timed out."}))},(t==null?void 0:t.timeout)||1e4)};export{V as loadChatUi,H as template};
