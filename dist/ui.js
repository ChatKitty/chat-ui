"use strict";var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var F=(t,e,n)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var H=(t,e)=>{for(var n in e)g(t,n,{get:e[n],enumerable:!0})},R=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of S(e))!z.call(t,a)&&a!==n&&g(t,a,{get:()=>e[a],enumerable:!(i=N(e,a))||i.enumerable});return t};var V=t=>R(g({},"__esModule",{value:!0}),t);var C=(t,e,n)=>(F(t,typeof e!="symbol"?e+"":e,n),n);var q={};H(q,{loadChatUi:()=>j,template:()=>W});module.exports=V(q);var v=require("lit-html");var O=require("lit-html"),k=({message:t})=>O.html`<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Error: ${t}</title><style>body{font-family:Arial,sans-serif;background-color:#f7f9fc;color:#333;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:0}.error-container{max-width:600px;padding:20px;background-color:#fff;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,.1);text-align:center}.error-header{font-size:24px;font-weight:700;margin-bottom:10px}.error-description{margin-bottom:20px}.error-hint{font-size:14px;color:#666}a{color:#007bff;text-decoration:none}a:hover{text-decoration:underline}</style></head><body><div class="error-container"><div class="error-header">Oops! ${t}</div><div class="error-description">We're sorry, but the Chat UI service is currently unavailable. Please try again later.</div><div class="error-hint">If the problem persists, please <a href="mailto:support@chatkitty.com">contact support</a>.</div></div></body></html>`;var w=class{constructor(e){C(this,"listeners");C(this,"port");this.listeners=new Map,e.addEventListener("message",n=>{let{type:i,payload:a}=n.data;if(!this.listeners.has(i))return;this.listeners.get(i).forEach(r=>{r(a)})}),this.port=e}subscribe(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}unsubscribe(e,n){if(!this.listeners.has(e))return;let i=this.listeners.get(e),a=i.indexOf(n);a>-1&&i.splice(a,1)}dispatch(e){this.port.postMessage(e)}};var y="https://ui.chatkitty.com",A=(t,e)=>{let n=document.createElement("div");(0,v.render)(e,n),t.srcdoc=n.innerHTML},W=v.html,j=(t,e)=>{var M,I,L,T,$,K,P;let n=t.username||((L=(I=(M=e==null?void 0:e.connection)==null?void 0:M.user)==null?void 0:I.value)==null?void 0:L.name),i=e==null?void 0:e.$environment;if(!n)throw new Error("Chat UI username is required. Please specify a username in your ChatKitty.loadChatUi call or pass an existing API connection.");y=i===void 0?y:i==="staging"?"https://ui.staging.chatkitty.com":i;let a=((T=t.container)==null?void 0:T.id)||"chat-ui",c=document.getElementById(a);if(!c)throw new Error(`Chat UI container not found. Please define a div with id "${a}" in your HTML page.`);if(c.hasChildNodes())throw new Error(`Chat UI container must be empty. Please remove all child elements from the div with id "${a}".`);c.style.display="relative",c.style.height=(($=t.container)==null?void 0:$.height)||"100vh",c.style.width=((K=t.container)==null?void 0:K.width)||"100%";let r=document.createElement("iframe");r.title="Chat UI",r.src=`${y}/chat?widget_id=${t.widgetId}${t.locale?`&locale=${t.locale}`:""}`,r.allow="autoplay; clipboard-write; fullscreen; geolocation; microphone",r.style.height="100%",r.style.width="100%",r.style.border="none";let E=new MessageChannel,b=E.port1,s=new w(b),x=!1;s.subscribe("chat-ui:connected",()=>{var o;s.dispatch({type:"chat:initialize",payload:{options:{username:n,theme:t.theme,authentication:t.authentication,profile:t.profile,route:t.route,api:{environment:(o=e==null?void 0:e.connection)==null?void 0:o.environment}}}}),x=!0}),s.subscribe("chat:mounted",o=>{var D;let m=(D=t.components)==null?void 0:D.chat;if(!m)return;let l=m({locale:o.locale}),p=t.localization;p&&s.dispatch({type:"chat:strings-set",payload:{strings:p({locale:o.locale})}});let f=t.audio;f&&s.dispatch({type:"chat:audio-set",payload:{audio:f}});let d=l.menuActions;d==null||d.forEach(h=>{if(h.name.includes("$"))throw new Error(`Menu action name "${h.name}" cannot contain "$" character.`)}),d&&s.dispatch({type:"chat:menu-actions-set",payload:{actions:d}});let u=l.onMounted;u&&u();let B=l.onHeaderSelected;B&&s.subscribe("chat:header-selected",h=>{B(h)});let _=l.onMenuActionSelected;_&&s.subscribe("chat:menu-action-selected",h=>{_(h)})}),window.addEventListener("message",o=>{var l,p;if(o.origin!==y||o.data!=="chatkitty:chat-ui-mounted")return;let m="standalone";if(e!=null&&e.connection){let f=e.connection,{user:d}=f,u=(l=d.value)==null?void 0:l.name;if(t.username&&t.username!==u)throw new Error(`Chat UI username "${t.username}" does not match connection username "${u}".`);f.attach(b),m="shared"}(p=r.contentWindow)==null||p.postMessage({type:"chat-ui:connect",payload:{version:"2.32.1",environment:"production",connection:m}},y,[E.port2])});let U=((P=t.templates)==null?void 0:P.error)||k;r.addEventListener("error",o=>{A(r,U({message:o.message}))}),b.start(),c.appendChild(r),setTimeout(()=>{x||A(r,U({message:"Connection timed out."}))},(e==null?void 0:e.timeout)||1e4)};0&&(module.exports={loadChatUi,template});
